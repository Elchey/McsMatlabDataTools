<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of plot</title>
  <meta name="keywords" content="plot">
  <meta name="description" content="Plot the contents of a McsAnalogStream object.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">+McsHDF5</a> &gt; <a href="index.html">@McsAnalogStream</a> &gt; plot.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for +McsHDF5/@McsAnalogStream&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>plot
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>Plot the contents of a McsAnalogStream object.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function plot(analogStream,cfg,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Plot the contents of a McsAnalogStream object.

 function plot(analogStream,cfg,varargin)

 Produces a time series plot with the channels overlayed over each other.

 Input:

   analogStream    -   A McsAnalogStream object

   cfg             -   Either empty (for default parameters) or a
                       structure with (some of) the following fields:
                       'channels': empty for all channels, otherwise a
                           vector of channel indices (default: all)
                       'window': empty for the whole time range, otherwise
                           a vector with two entries: [start end] of the 
                           time range, both in seconds.
                       'legend': either true (default) or false. Matlab
                           can be very inefficient in plotting legends for
                           many channels and many time segments. In this
                           case it can be advisable to shut legend
                           generation off.
                       'spacing': either true or false (default). If
                           false, no spacing is used. Otherwise, an offset
                           is added to each channel to separate them.
                           Using this option means that the y-axis is only
                           valid for the first channel
                       If fields are missing, their default values are used.

   optional inputs in varargin are passed to the plot function.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="plot.html" class="code" title="function plot(analogStream,cfg,varargin)">plot</a>	Plot the contents of a McsAnalogStream object.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="plot.html" class="code" title="function plot(analogStream,cfg,varargin)">plot</a>	Plot the contents of a McsAnalogStream object.</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function plot(analogStream,cfg,varargin)</a>
0002 <span class="comment">% Plot the contents of a McsAnalogStream object.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% function plot(analogStream,cfg,varargin)</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% Produces a time series plot with the channels overlayed over each other.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% Input:</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%   analogStream    -   A McsAnalogStream object</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%   cfg             -   Either empty (for default parameters) or a</span>
0013 <span class="comment">%                       structure with (some of) the following fields:</span>
0014 <span class="comment">%                       'channels': empty for all channels, otherwise a</span>
0015 <span class="comment">%                           vector of channel indices (default: all)</span>
0016 <span class="comment">%                       'window': empty for the whole time range, otherwise</span>
0017 <span class="comment">%                           a vector with two entries: [start end] of the</span>
0018 <span class="comment">%                           time range, both in seconds.</span>
0019 <span class="comment">%                       'legend': either true (default) or false. Matlab</span>
0020 <span class="comment">%                           can be very inefficient in plotting legends for</span>
0021 <span class="comment">%                           many channels and many time segments. In this</span>
0022 <span class="comment">%                           case it can be advisable to shut legend</span>
0023 <span class="comment">%                           generation off.</span>
0024 <span class="comment">%                       'spacing': either true or false (default). If</span>
0025 <span class="comment">%                           false, no spacing is used. Otherwise, an offset</span>
0026 <span class="comment">%                           is added to each channel to separate them.</span>
0027 <span class="comment">%                           Using this option means that the y-axis is only</span>
0028 <span class="comment">%                           valid for the first channel</span>
0029 <span class="comment">%                       If fields are missing, their default values are used.</span>
0030 <span class="comment">%</span>
0031 <span class="comment">%   optional inputs in varargin are passed to the plot function.</span>
0032     
0033     clf
0034 
0035     <span class="keyword">if</span> isempty(cfg)
0036         cfg.channels = [];
0037         cfg.window = [];
0038         cfg.legend = true;
0039         cfg.spacing = false;
0040     <span class="keyword">end</span>
0041     
0042     <span class="keyword">if</span> ~isfield(cfg,<span class="string">'legend'</span>) || isempty(cfg.legend)
0043         cfg.legend = true;
0044     <span class="keyword">end</span>
0045     
0046     <span class="keyword">if</span> ~isfield(cfg,<span class="string">'channels'</span>) 
0047         cfg.channels = []; 
0048     <span class="keyword">end</span>
0049     
0050     <span class="keyword">if</span> ~isfield(cfg,<span class="string">'window'</span>) 
0051         cfg.window = []; 
0052     <span class="keyword">end</span>
0053     
0054     <span class="keyword">if</span> ~isfield(cfg,<span class="string">'spacing'</span>) || isempty(cfg.spacing)
0055         cfg.spacing = false;
0056     <span class="keyword">end</span>
0057     
0058     <span class="keyword">if</span> isempty(cfg.channels)
0059         cfg.channels = 1:size(analogStream.ChannelData,1);
0060     <span class="keyword">end</span>
0061     
0062     <span class="keyword">if</span> isempty(cfg.window)
0063         cfg.window = McsHDF5.TickToSec([analogStream.ChannelDataTimeStamps(1) <span class="keyword">...</span>
0064                       analogStream.ChannelDataTimeStamps(end)]);
0065     <span class="keyword">end</span>
0066     
0067     <span class="keyword">if</span> any(cfg.channels &lt; 1 | cfg.channels &gt; size(analogStream.ChannelData,1))
0068         cfg.channels = cfg.channels(cfg.channels &gt;= 1 &amp; cfg.channels &lt;= size(analogStream.ChannelData,1));
0069         <span class="keyword">if</span> isempty(cfg.channels)
0070             error(<span class="string">'No channels found!'</span>);
0071         <span class="keyword">else</span>
0072             warning([<span class="string">'Using only channel indices between '</span> num2str(cfg.channels(1)) <span class="string">' and '</span> num2str(cfg.channels(end)) <span class="string">'!'</span>]);
0073         <span class="keyword">end</span>
0074     <span class="keyword">end</span>
0075 
0076     start_index = find(analogStream.ChannelDataTimeStamps &gt;= McsHDF5.SecToTick(cfg.window(1)),1,<span class="string">'first'</span>);
0077     end_index = find(analogStream.ChannelDataTimeStamps &lt;= McsHDF5.SecToTick(cfg.window(2)),1,<span class="string">'last'</span>);
0078     
0079     <span class="keyword">if</span> end_index &lt; start_index
0080         warning(<span class="string">'No time range found'</span>)
0081         <span class="keyword">return</span>
0082     <span class="keyword">end</span>
0083     
0084     <span class="keyword">if</span> strcmp(analogStream.DataType,<span class="string">'raw'</span>)
0085         conv_cfg = [];
0086         conv_cfg.dataType = <span class="string">'double'</span>;
0087         data_to_plot = analogStream.getConvertedData(conv_cfg);
0088         data_to_plot = data_to_plot(cfg.channels,start_index:end_index);
0089     <span class="keyword">else</span>
0090         data_to_plot = analogStream.ChannelData(cfg.channels,start_index:end_index);
0091     <span class="keyword">end</span>
0092     
0093     orig_exp = log10(max(abs(data_to_plot(:))));
0094     unit_exp = double(analogStream.Info.Exponent(1));
0095     
0096     [fact,unit_string] = McsHDF5.ExponentToUnit(orig_exp+unit_exp,orig_exp);
0097     
0098     data_to_plot = data_to_plot * fact;
0099     
0100     <span class="keyword">if</span> cfg.spacing
0101         mi = min(data_to_plot);
0102         ma = max(data_to_plot);
0103         offset = cumsum([0 ma(2:end)-mi(1:end-1)]);
0104         data_to_plot = bsxfun(@minus,data_to_plot,offset);
0105     <span class="keyword">end</span>
0106     
0107     timestamps = McsHDF5.TickToSec(analogStream.ChannelDataTimeStamps(start_index:end_index));
0108     
0109     segstarts = [0 find(diff(timestamps) &gt; 2*McsHDF5.TickToSec(analogStream.Info.Tick(1))) length(timestamps)-1] + 1;
0110     
0111     <span class="keyword">for</span> segi = 1:length(segstarts)-1
0112         segidx = segstarts(segi):segstarts(segi+1)-1;
0113         <span class="keyword">if</span> isempty([varargin{:}])
0114             <a href="plot.html" class="code" title="function plot(analogStream,cfg,varargin)">plot</a>(timestamps(segidx),data_to_plot(:,segidx));
0115         <span class="keyword">else</span>
0116             <a href="plot.html" class="code" title="function plot(analogStream,cfg,varargin)">plot</a>(timestamps(segidx),data_to_plot(:,segidx),varargin{:});
0117         <span class="keyword">end</span>
0118         hold on
0119     <span class="keyword">end</span>
0120     
0121     hold off
0122     chan_names = analogStream.Info.Label(cfg.channels);
0123     <span class="keyword">if</span> cfg.legend
0124         legend(chan_names);
0125     <span class="keyword">end</span>
0126     
0127     title([analogStream.Label]);
0128     xlabel(<span class="string">'Time [s]'</span>)
0129     ylabel([unit_string analogStream.Info.Unit{1}],<span class="string">'Interpreter'</span>,<span class="string">'tex'</span>)
0130     
0131 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 26-Mar-2014 15:28:34 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>