<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of plot</title>
  <meta name="keywords" content="plot">
  <meta name="description" content="Plot the contents of a McsFrameDataEntity object.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">+McsHDF5</a> &gt; <a href="index.html">@McsFrameDataEntity</a> &gt; plot.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for +McsHDF5/@McsFrameDataEntity&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>plot
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>Plot the contents of a McsFrameDataEntity object.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function plot(frame,cfg,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Plot the contents of a McsFrameDataEntity object.

 function plot(frame,cfg,varargin)

 Will either produce a 3D figure of the channel amplitudes at a single
 time point, or a 2D matrix of plots, each showing the signal of a single
 channel for a given time range.

 Input:

   frame       - A McsFrameDataEntity object.

   cfg         -   Either empty (for default parameters) or a
                   structure with (some of) the following fields:
                   'channelMatrix': empty for all channels, otherwise a
                       matrix of bools with size channels_x x channels_y.
                       All channels with 'true' entries in this matrix are
                       used in the plots. (default: all channels)
                   'window': empty for the whole time range, otherwise
                       either a vector with two entries: [start end] of
                       the time range, both in seconds, or a scalar: a
                       time point in seconds. If a range is given, the
                       signal of each channel in this range is plotted
                       individually. For a single time plot, a 2D/3D image
                       over all channels is generated.
               If fields are missing, their default values are used.

   Optional inputs in varargin are passed to the plot function.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="plot.html" class="code" title="function plot(frame,cfg,varargin)">plot</a>	Plot the contents of a McsFrameDataEntity object.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="frameMovie.html" class="code" title="function frameMovie(fde,cfg,varargin)">frameMovie</a>	Display animation of the frame data</li><li><a href="plot.html" class="code" title="function plot(frame,cfg,varargin)">plot</a>	Plot the contents of a McsFrameDataEntity object.</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function plot(frame,cfg,varargin)</a>
0002 <span class="comment">% Plot the contents of a McsFrameDataEntity object.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% function plot(frame,cfg,varargin)</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% Will either produce a 3D figure of the channel amplitudes at a single</span>
0007 <span class="comment">% time point, or a 2D matrix of plots, each showing the signal of a single</span>
0008 <span class="comment">% channel for a given time range.</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% Input:</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%   frame       - A McsFrameDataEntity object.</span>
0013 <span class="comment">%</span>
0014 <span class="comment">%   cfg         -   Either empty (for default parameters) or a</span>
0015 <span class="comment">%                   structure with (some of) the following fields:</span>
0016 <span class="comment">%                   'channelMatrix': empty for all channels, otherwise a</span>
0017 <span class="comment">%                       matrix of bools with size channels_x x channels_y.</span>
0018 <span class="comment">%                       All channels with 'true' entries in this matrix are</span>
0019 <span class="comment">%                       used in the plots. (default: all channels)</span>
0020 <span class="comment">%                   'window': empty for the whole time range, otherwise</span>
0021 <span class="comment">%                       either a vector with two entries: [start end] of</span>
0022 <span class="comment">%                       the time range, both in seconds, or a scalar: a</span>
0023 <span class="comment">%                       time point in seconds. If a range is given, the</span>
0024 <span class="comment">%                       signal of each channel in this range is plotted</span>
0025 <span class="comment">%                       individually. For a single time plot, a 2D/3D image</span>
0026 <span class="comment">%                       over all channels is generated.</span>
0027 <span class="comment">%               If fields are missing, their default values are used.</span>
0028 <span class="comment">%</span>
0029 <span class="comment">%   Optional inputs in varargin are passed to the plot function.</span>
0030 
0031     clf
0032     
0033     <span class="keyword">if</span> isempty(cfg)
0034         cfg.window = [];
0035         cfg.channelMatrix = [];
0036     <span class="keyword">end</span>
0037     
0038     <span class="keyword">if</span> ~isfield(cfg,<span class="string">'window'</span>)
0039         cfg.window = [];
0040     <span class="keyword">end</span>
0041     
0042     <span class="keyword">if</span> ~isfield(cfg,<span class="string">'channelMatrix'</span>)
0043         cfg.channelMatrix = [];
0044     <span class="keyword">end</span>
0045     
0046     <span class="keyword">if</span> isempty(cfg.window)
0047         cfg.window = McsHDF5.TickToSec([frame.FrameDataTimeStamps(1) frame.FrameDataTimeStamps(end)]);
0048     <span class="keyword">end</span>
0049     <span class="keyword">if</span> isempty(cfg.channelMatrix)
0050         cfg.channelMatrix = true(size(frame.FrameData,1),size(frame.FrameData,2));
0051     <span class="keyword">end</span>
0052     
0053     <span class="keyword">if</span> size(cfg.channelMatrix,1) ~= size(frame.FrameData,1) || size(cfg.channelMatrix,2) ~= size(frame.FrameData,2)
0054         error(<span class="string">'Size of cfg.channelMatrix does not match the number of channels in the file!'</span>);
0055     <span class="keyword">end</span>
0056     
0057     <span class="keyword">if</span> numel(cfg.window) == 1 || cfg.window(1) == cfg.window(2)
0058         <span class="comment">% plot single time point as a 3D visualization</span>
0059         
0060         idx = find(abs(frame.FrameDataTimeStamps - McsHDF5.SecToTick(cfg.window(1))) &lt;= frame.Info.Tick);
0061         <span class="keyword">if</span> isempty(idx)
0062             warning(<span class="string">'No data point found!'</span>)
0063             <span class="keyword">return</span>;
0064         <span class="keyword">elseif</span> numel(idx) &gt; 1
0065             [~,tmp] = min(abs(frame.FrameDataTimeStamps(idx) - McsHDF5.SecToTick(cfg.window(1))));
0066             idx = idx(tmp);
0067         <span class="keyword">end</span>
0068         
0069         <span class="keyword">if</span> strcmp(frame.DataType,<span class="string">'raw'</span>)
0070             cfg_part = [];
0071             cfg_part.window = McsHDF5.TickToSec([frame.FrameDataTimeStamps(idx) frame.FrameDataTimeStamps(idx) + frame.Info.Tick - 1]);
0072             tmp_frame = frame.readPartialFrame(cfg_part);
0073             cfg_conv = [];
0074             cfg_conv.dataType = <span class="string">'double'</span>;
0075             data_to_plot = tmp_frame.getConvertedData(cfg_conv);
0076         <span class="keyword">elseif</span> strcmp(frame.DataType,<span class="string">'single'</span>)
0077             data_to_plot = cast(frame.FrameData(:,:,idx),<span class="string">'double'</span>);
0078         <span class="keyword">else</span>
0079             data_to_plot = frame.FrameData(:,:,idx);
0080         <span class="keyword">end</span>
0081         
0082         orig_exp = log10(max(abs(data_to_plot(cfg.channelMatrix(:)))));
0083         unit_exp = double(frame.Info.Exponent);
0084 
0085         [fact,unit_string] = McsHDF5.ExponentToUnit(orig_exp+unit_exp,orig_exp);
0086 
0087         data_to_plot = squeeze(data_to_plot * fact);
0088         data_to_plot(~cfg.channelMatrix) = NaN;
0089 
0090         [X,Y] = meshgrid(1:size(data_to_plot,2),1:size(data_to_plot,1));
0091         <span class="keyword">if</span> isempty([varargin{:}])
0092             surf(X,Y,data_to_plot);
0093         <span class="keyword">else</span>
0094             surf(X,Y,data_to_plot,varargin{:});
0095         <span class="keyword">end</span>
0096         xlabel(<span class="string">'y channels'</span>)
0097         ylabel(<span class="string">'x channels'</span>)
0098         zlabel([unit_string frame.Info.Unit{1}],<span class="string">'Interpreter'</span>,<span class="string">'tex'</span>)
0099         title([<span class="string">'Time: '</span> num2str(cfg.window(1)) <span class="string">' [s]'</span>])
0100     <span class="keyword">else</span>
0101         <span class="comment">% plot time range with a 2D array of plots, each plot showing the</span>
0102         <span class="comment">% time series in the time range for a specific channel.</span>
0103         start_index = find(frame.FrameDataTimeStamps &gt;= McsHDF5.SecToTick(cfg.window(1)),1,<span class="string">'first'</span>);
0104         end_index = find(frame.FrameDataTimeStamps &lt;= McsHDF5.SecToTick(cfg.window(2)),1,<span class="string">'last'</span>);
0105 
0106         <span class="keyword">if</span> end_index &lt; start_index
0107             warning(<span class="string">'No time range found'</span>)
0108             <span class="keyword">return</span>
0109         <span class="keyword">end</span>
0110 
0111         timestamps = McsHDF5.TickToSec(frame.FrameDataTimeStamps(start_index:end_index));
0112         
0113         <span class="keyword">if</span> ~strcmp(frame.DataType,<span class="string">'raw'</span>)
0114 
0115             num_x = size(frame.FrameData,1);
0116             num_y = size(frame.FrameData,2);
0117 
0118             left = 0.08;
0119             bottom = 0.08;
0120 
0121             width = (1-left)/(1.1*num_x+0.1);
0122             spacing_x = 0.1*width;
0123             height = (1-bottom)/(1.1*num_y+0.1);
0124             spacing_y = 0.1*height;
0125             
0126             range_y = [Inf -Inf];
0127             <span class="comment">% this is slower but more memory efficient than indexing the</span>
0128             <span class="comment">% cube</span>
0129             <span class="keyword">for</span> xi = 1:num_x
0130                 <span class="keyword">for</span> yi = 1:num_y
0131                     <span class="keyword">if</span> cfg.channelMatrix(xi,yi)
0132                         vals = squeeze(frame.FrameData(xi,yi,start_index:end_index));
0133                         <span class="keyword">if</span> min(vals) &lt; range_y(1)
0134                             range_y(1) = min(vals);
0135                         <span class="keyword">end</span>
0136                         <span class="keyword">if</span> max(vals) &gt; range_y(2)
0137                             range_y(2) = max(vals);
0138                         <span class="keyword">end</span>
0139                     <span class="keyword">end</span>
0140                 <span class="keyword">end</span>
0141             <span class="keyword">end</span>
0142             
0143             orig_exp = log10(range_y(2));
0144             unit_exp = double(frame.Info.Exponent);
0145 
0146             [fact,unit_string] = McsHDF5.ExponentToUnit(orig_exp+unit_exp,orig_exp);
0147             range_y = range_y * fact;
0148 
0149             <span class="keyword">for</span> xi = 1:num_x
0150                 <span class="keyword">for</span> yi = 1:num_y
0151                     <span class="keyword">if</span> cfg.channelMatrix(xi,yi)
0152                         axes(<span class="string">'position'</span>,[left+xi*spacing_x+(xi-1)*width,<span class="keyword">...</span>
0153                                         1-(yi*spacing_y+yi*height),<span class="keyword">...</span>
0154                                         width,height]);
0155                         <span class="keyword">if</span> isempty([varargin{:}])
0156                             <a href="plot.html" class="code" title="function plot(frame,cfg,varargin)">plot</a>(timestamps,squeeze(frame.FrameData(xi,yi,start_index:end_index))*fact);
0157                         <span class="keyword">else</span>
0158                             <a href="plot.html" class="code" title="function plot(frame,cfg,varargin)">plot</a>(timestamps,squeeze(frame.FrameData(xi,yi,start_index:end_index))*fact,varargin{:});
0159                         <span class="keyword">end</span>
0160                         axis([timestamps(1) timestamps(end) range_y(1) range_y(2)]);
0161                         <span class="keyword">if</span> xi &gt; 1 &amp;&amp; yi &lt; num_y
0162                             axis off
0163                         <span class="keyword">else</span>
0164                             set(gca,<span class="string">'Box'</span>,<span class="string">'off'</span>);
0165                             set(gca,<span class="string">'color'</span>,get(gcf,<span class="string">'Color'</span>))
0166                         <span class="keyword">end</span>
0167                         <span class="keyword">if</span> yi == num_y
0168                             xlabel(<span class="string">'Time [s]'</span>)
0169                             <span class="keyword">if</span> xi ~= 1
0170                                 set(gca,<span class="string">'YTick'</span>,[])
0171                                 set(gca,<span class="string">'YColor'</span>,get(gcf,<span class="string">'Color'</span>))
0172                             <span class="keyword">end</span>
0173                         <span class="keyword">end</span>
0174                         <span class="keyword">if</span> xi == 1
0175                             ylabel([unit_string frame.Info.Unit{1}],<span class="string">'Interpreter'</span>,<span class="string">'tex'</span>)
0176                             <span class="keyword">if</span> yi ~= num_y
0177                                 set(gca,<span class="string">'XTick'</span>,[])
0178                                 set(gca,<span class="string">'XColor'</span>,get(gcf,<span class="string">'Color'</span>))
0179                             <span class="keyword">end</span>
0180                         <span class="keyword">end</span>
0181                     <span class="keyword">end</span>
0182                 <span class="keyword">end</span>
0183             <span class="keyword">end</span>
0184         <span class="keyword">else</span>
0185             cfg_conv = [];
0186             cfg_conv.dataType = <span class="string">'double'</span>;
0187             data_to_plot = frame.getConvertedData(cfg_conv);
0188             orig_exp = log10(max(max(max(abs(data_to_plot(:,:,start_index:end_index))))));
0189             unit_exp = double(frame.Info.Exponent);
0190 
0191             [fact,unit_string] = McsHDF5.ExponentToUnit(orig_exp+unit_exp,orig_exp);
0192 
0193             num_x = size(frame.FrameData,1);
0194             num_y = size(frame.FrameData,2);
0195 
0196             left = 0.08;
0197             bottom = 0.08;
0198 
0199             width = (1-left)/(1.1*num_x+0.1);
0200             spacing_x = 0.1*width;
0201             height = (1-bottom)/(1.1*num_y+0.1);
0202             spacing_y = 0.1*height;
0203 
0204             idx = repmat(find(cfg.channelMatrix),1,length(start_index:end_index));
0205             offs = ((start_index:end_index) - 1) * numel(cfg.channelMatrix);
0206             idx = bsxfun(@plus,idx,offs);
0207             range_y = [min(data_to_plot(idx(:))), max(data_to_plot(idx(:)))]*fact;
0208 
0209             <span class="keyword">for</span> xi = 1:num_x
0210                 <span class="keyword">for</span> yi = 1:num_y
0211                     <span class="keyword">if</span> cfg.channelMatrix(xi,yi)
0212                         axes(<span class="string">'position'</span>,[left+xi*spacing_x+(xi-1)*width,<span class="keyword">...</span>
0213                                         1-(yi*spacing_y+yi*height),<span class="keyword">...</span>
0214                                         width,height]);
0215                         <span class="keyword">if</span> isempty([varargin{:}])
0216                             <a href="plot.html" class="code" title="function plot(frame,cfg,varargin)">plot</a>(timestamps,squeeze(data_to_plot(xi,yi,start_index:end_index))*fact);
0217                         <span class="keyword">else</span>
0218                             <a href="plot.html" class="code" title="function plot(frame,cfg,varargin)">plot</a>(timestamps,squeeze(data_to_plot(xi,yi,start_index:end_index))*fact,varargin{:});
0219                         <span class="keyword">end</span>
0220                         axis([timestamps(1) timestamps(end) range_y(1) range_y(2)]);
0221                         <span class="keyword">if</span> xi &gt; 1 &amp;&amp; yi &lt; num_y
0222                             axis off
0223                         <span class="keyword">else</span>
0224                             set(gca,<span class="string">'Box'</span>,<span class="string">'off'</span>);
0225                             set(gca,<span class="string">'color'</span>,get(gcf,<span class="string">'Color'</span>))
0226                         <span class="keyword">end</span>
0227                         <span class="keyword">if</span> yi == num_y
0228                             xlabel(<span class="string">'Time [s]'</span>)
0229                             <span class="keyword">if</span> xi ~= 1
0230                                 set(gca,<span class="string">'YTick'</span>,[])
0231                                 set(gca,<span class="string">'YColor'</span>,get(gcf,<span class="string">'Color'</span>))
0232                             <span class="keyword">end</span>
0233                         <span class="keyword">end</span>
0234                         <span class="keyword">if</span> xi == 1
0235                             ylabel([unit_string frame.Info.Unit{1}],<span class="string">'Interpreter'</span>,<span class="string">'tex'</span>)
0236                             <span class="keyword">if</span> yi ~= num_y
0237                                 set(gca,<span class="string">'XTick'</span>,[])
0238                                 set(gca,<span class="string">'XColor'</span>,get(gcf,<span class="string">'Color'</span>))
0239                             <span class="keyword">end</span>
0240                         <span class="keyword">end</span>
0241                     <span class="keyword">end</span>
0242                 <span class="keyword">end</span>
0243             <span class="keyword">end</span>
0244         <span class="keyword">end</span>
0245     <span class="keyword">end</span>
0246 
0247 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 26-Mar-2014 15:28:34 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>